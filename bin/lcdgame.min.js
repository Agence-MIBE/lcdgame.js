/* LCD game JavaScript library v0.3.1 -- by BdR 2018 */

var LCDGAME_VERSION="0.3.1",LCDGame=LCDGame||{loadsounds:null,countimages:0,scaleFactor:1,score:0,gametype:0,level:0,onImageLoaded:null,onImageError:null,canvas:null,context2d:null};LCDGame.StateManager=function(t){this.lcdgame=t,this._currentState,this.states={}},LCDGame.StateManager.prototype={add:function(t,e){return this.states[t]=new e(this.lcdgame),this._currentState=t,e},start:function(t){this._currentState&&this._currentState!=t&&this.states[this._currentState].destroy,this._currentState=t,this.states[this._currentState].init()},currentState:function(t){if(this._currentState&&this._currentState!=t)return this.states[this._currentState]}},LCDGame.State=function(){this.lcdgame=null,this.key="",this.statemanager=null},LCDGame.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){}},LCDGame.State.prototype.constructor=LCDGame.State;var MENU_HTML='<div class="container">  <canvas id="mycanvas" class="gamecvs" width="400" height="300"></canvas>  <a class="mybutton btnmenu">info</a>  <a class="mybutton btnmenu" onclick="displayInfobox();">help</a>  <div class="infobox" id="infobox">    <div>      <h1>test123</h1>      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.    </div>    <a class="mybutton btnpop" onclick="hideInfobox();">Ok</a>  </div></div>';function displayInfobox(){hideScorebox(),document.getElementById("infobox").style.display="inherit"}function hideInfobox(){document.getElementById("infobox").style.display="none"}LCDGame.Menu=function(t,e){this.lcdgame=t};var SCORE_HTML='<div class="infobox" id="scorebox">  <div id="scorecontent">    high-scores',HS_URL="http://bdrgames.nl/lcdgames/php/";function displayScorebox(){hideInfobox(),document.getElementById("scorebox").style.display="inherit"}function hideScorebox(){document.getElementById("scorebox").style.display="none"}LCDGame.HighScores=function(t,e,a){this.lcdgame=t,this.gametitle=e,this.gametypes=a,this._scorecache=[],this._scoretype=0,this._namecache=""},LCDGame.HighScores.prototype={getGametype:function(){var t="";return this.gametypes&&(this.lcdgame.gametype,t=this.gametypes[this.lcdgame.gametype-1]),t},loadHighscores:function(t){this._scorecache=[],this._scoretype=t,this._namecache="lcdgame_"+this.gametitle+"_hs"+t;var e=window.localStorage.getItem(this._namecache);try{this._scorecache=JSON.parse(e)}catch(t){this._scorecache=[]}"[object Array]"!==Object.prototype.toString.call(this._scorecache)&&(this._scorecache=[])},save:function(){window.localStorage.setItem(this._namecache,JSON.stringify(this._scorecache))},scoreIndex:function(t,e){e!=this._scoretype&&this.loadHighscores(e);for(var a=-1,s=this._scorecache.length-1;0<=s&&t>this._scorecache[s].score;s--)a=s;return a},saveLocal:function(t,e,a,s){var i=this.scoreIndex(e,s);if(0<=i){var n={player:t,score:e,level:a};this._scorecache.splice(i,0,n);var o=10-this._scorecache.length;o<0&&this._scorecache.splice(o),this.save()}},saveOnline:function(t,e,a,s){var i=navigator.platform,n=this.guessBrowser(),o=navigator.language,r=this.getClientGUID(),d=HS_URL+"newhs.php",h="gamename="+this.gametitle+"&gametype="+s+"&player="+t+"&score="+e+"&level="+a+"&platform="+i+"&browser="+n+"&language="+o+"&lcdversion="+LCDGAME_VERSION+"&clientguid="+r,c=new XMLHttpRequest;c.open("POST",d,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.onreadystatechange=function(t){200<=c.status&&c.status<400?4==c.readyState&&200==c.status&&(console.log("SUCCESS!!\nrequest.status="+c.status+"\nrequest.response="+c.response),"OK"==JSON.parse(c.response).result?(console.log("Highscore sent succesfully"),this.refreshGlobalHS(),displayScorebox()):console.log("Highscore sent failed")):(console.log("Highscore sent failed with error: "+c.response),resulttxt.text+="\nerror!")}.bind(this),c.send(h)},checkScore:function(){var t=this.lcdgame.score,e=this.lcdgame.level,a=this.lcdgame.gametype;if(0<t){var s=prompt("New highscore, enter your name and press enter to submit or press cancel.","");null!=s&&(this.saveLocal(s,t,e,a),this.saveOnline(s,t,e,a))}},refreshGlobalHS:function(){var t=HS_URL+"geths.php?gamename="+this.gametitle+"&gametype="+this.lcdgame.gametype,e=new XMLHttpRequest;e.open("GET",t,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&this.afterRefreshGlobalHS(e.responseText)}.bind(this),e.send(null)},afterRefreshGlobalHS:function(t){try{this._scorecache=JSON.parse(t)}catch(t){this._scorecache=[]}"[object Array]"!==Object.prototype.toString.call(this._scorecache)&&(this._scorecache=[]),this.refreshHTML()},refreshHTML:function(){for(var t="",e=0;e<10;e++){var a=this._scorecache[e];void 0===a&&(a={player:".....",score:0,level:1}),t=t+"      <tr><td>"+(e+1)+".</td><td>"+a.player+"</td><td>"+a.score+"</td></tr>"}var s=this.getGametype();s=""==s?s:" ("+s+")";var i="<h1>"+this.gametitle+s+"</h1><table>      <tr><td>Rk.</td><td>Name</td><td>Score</td></tr>"+t+"    </table>";this.lcdgame.scorecontent.innerHTML=i},uuidv4:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})},getClientGUID:function(){var t=window.localStorage.getItem("lcdgame_client_guid");return t||(t=this.uuidv4(),window.localStorage.setItem("lcdgame_client_guid",t)),t},guessBrowser:function(){return window.opr&&opr.addons||window.opera||0<=navigator.userAgent.indexOf(" OPR/")?"Opera 8.0+":"undefined"!=typeof InstallTrigger?"Firefox 1.0+":/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString()?"Safari 3.0+":document.documentMode?"Internet Explorer 6-11":window.StyleMedia?"Edge 20+":window.chrome&&window.chrome.webstore?"Chrome 1+":"Unknown"}},LCDGame.Game=function(t,e){this.gamedata=[],this.imageBackground=null,this.imageShapes=null,this.score=0,this.gametype=0,this.level=0,this.countimages=0,this.scaleFactor=1,this.imageBackground=new Image,this.imageShapes=new Image,this.imageBackground.addEventListener?(this.imageBackground.addEventListener("load",this.onImageLoaded.bind(this)),this.imageBackground.addEventListener("error",this.onImageError.bind(this)),this.imageShapes.addEventListener("load",this.onImageLoaded.bind(this)),this.imageShapes.addEventListener("error",this.onImageError.bind(this))):(this.imageBackground.attachEvent("load",this.onImageLoaded.bind(this)),this.imageBackground.attachEvent("error",this.onImageError.bind(this)),this.imageShapes.attachEvent("load",this.onImageLoaded.bind(this)),this.imageShapes.attachEvent("error",this.onImageError.bind(this)));return document.write('<div class="container">  <canvas id="mycanvas" class="gamecvs" width="400" height="300"></canvas>  <a class="mybutton btnmenu" onclick="displayInfobox();">info</a>  <a class="mybutton btnmenu" onclick="displayScorebox();">scores</a>  <div class="infobox" id="infobox">    <div id="infocontent">      instructions    </div>    <a class="mybutton btnpop" onclick="hideInfobox();">Ok</a>  </div></div><div class="infobox" id="scorebox">  <div id="scorecontent">    <table>      <tr><td>Rk.</td><td>Name</td><td>Score</td></tr>      <tr><td>1.</td><td>First name</td><td>1000</td></tr>      <tr><td>2.</td><td>Second name</td><td>900</td></tr>      <tr><td>3.</td><td>Third name</td><td>800</td></tr>      <tr><td>4.</td><td>Fourth name</td><td>700</td></tr>      <tr><td>5.</td><td>Fifth name</td><td>600</td></tr>      <tr><td>6.</td><td>Sixth name</td><td>500</td></tr>      <tr><td>7.</td><td>Seventh name</td><td>400</td></tr>      <tr><td>8.</td><td>Eight name</td><td>300</td></tr>      <tr><td>9.</td><td>Ninth name</td><td>200</td></tr>      <tr><td>10.</td><td>Tenth name</td><td>100</td></tr>    </table>  </div>  <a class="mybutton btnpop" onclick="hideScorebox();">Ok</a></div>'),this.canvas=document.getElementById("mycanvas"),this.infobox=document.getElementById("infobox"),this.scorebox=document.getElementById("scorebox"),this.infocontent=document.getElementById("infocontent"),this.scorecontent=document.getElementById("scorecontent"),this.context2d=this.canvas.getContext("2d"),this.state=new LCDGame.StateManager(this),this.loadConfig(t),e=e||"metadata/gameinfo.json",this.loadMetadata(e),this},LCDGame.Game.prototype={onImageLoaded:function(){this.countimages++,2<=this.countimages&&this.initGame()},onImageError:function(){console.log("** ERROR ** lcdgame.js - onImageError.")},loadConfig:function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status||0===e.status?this.onConfigLoad(JSON.parse(e.responseText)):this.onConfigError(e))}.bind(this),e.open("GET",t,!0),e.send()},onConfigLoad:function(t){this.gamedata=t,this.imageBackground.src=t.imgback,this.imageShapes.src=t.imgshapes;for(var e=0;e<this.gamedata.frames.length;e++)this.gamedata.frames[e].value=!1,this.gamedata.frames[e].valprev=!1,this.gamedata.frames[e].type="shape";for(var a=0;a<this.gamedata.sequences.length;a++){this.gamedata.sequences[a].ids=[];for(var s=0;s<this.gamedata.sequences[a].frames.length;s++){var i=this.gamedata.sequences[a].frames[s],n=this.shapeIndexByName(i);this.gamedata.sequences[a].ids.push(n)}}for(var o=0;o<this.gamedata.digits.length;o++){this.gamedata.digits[o].ids=[],this.gamedata.digits[o].locids=[];for(s=0;s<this.gamedata.digits[o].frames.length;s++){i=this.gamedata.digits[o].frames[s],n=this.shapeIndexByName(i);this.gamedata.digits[o].ids.push(n),-1!=n&&(this.gamedata.frames[n].type="digit")}for(var r=0;r<this.gamedata.digits[o].locations.length;r++){i=this.gamedata.digits[o].locations[r],n=this.shapeIndexByName(i);this.gamedata.digits[o].locids.push(n)}var d=this.gamedata.digits[o].max||"";if(""==d){for(var h=0;h<this.gamedata.digits[o].locids.length;h++)d+="8";this.gamedata.digits[o].max=d}}for(var c=0;c<this.gamedata.buttons.length;c++){this.gamedata.buttons[c].ids=[];var m=1e4,g=1e4,u=0,l=0;for(s=0;s<this.gamedata.buttons[c].frames.length;s++){i=this.gamedata.buttons[c].frames[s],n=this.shapeIndexByName(i);this.gamedata.buttons[c].ids.push(n);var f=this.gamedata.frames[n].spriteSourceSize;f.x<m&&(m=f.x),f.y<g&&(g=f.y),f.x+f.w>u&&(u=f.x+f.w),f.y+f.h>l&&(l=f.y+f.h)}var v=u-m,p=l-g;m=m-v,g=g-p,u=u+v,l=l+p;this.gamedata.buttons[c].area={x1:m,y1:g,x2:u,y2:l};var b=this.gamedata.buttons[c].name;void 0!==this.gamedata.buttons[c].defaultkeys&&(b=this.gamedata.buttons[c].defaultkeys),this.gamedata.buttons[c].keycodes=this.determineKeyCodes(b)}for(var y=0;y<this.gamedata.buttons.length-1;y++)for(var x=y+1;x<this.gamedata.buttons.length;x++)if(this.gamedata.buttons[y].area.x1<this.gamedata.buttons[x].area.x2&&this.gamedata.buttons[y].area.x2>this.gamedata.buttons[x].area.x1&&this.gamedata.buttons[y].area.y1<this.gamedata.buttons[x].area.y2&&this.gamedata.buttons[y].area.y2>this.gamedata.buttons[x].area.y1){var S=(this.gamedata.buttons[y].area.x1+this.gamedata.buttons[y].area.x2)/2,w=(this.gamedata.buttons[y].area.y1+this.gamedata.buttons[y].area.y2)/2,I=(this.gamedata.buttons[x].area.x1+this.gamedata.buttons[x].area.x2)/2,E=(this.gamedata.buttons[x].area.y1+this.gamedata.buttons[x].area.y2)/2;if(Math.abs(S-I)>Math.abs(w-E))if(I<S){var L=(this.gamedata.buttons[y].area.x1-this.gamedata.buttons[x].area.x2)/2;this.gamedata.buttons[y].area.x1+=L,this.gamedata.buttons[x].area.x2-=L}else{L=(this.gamedata.buttons[y].area.x2-this.gamedata.buttons[x].area.x1)/2;this.gamedata.buttons[y].area.x2-=L,this.gamedata.buttons[x].area.x1+=L}else if(E<w){L=(this.gamedata.buttons[y].area.y1-this.gamedata.buttons[x].area.y2)/2;this.gamedata.buttons[y].area.y1+=L,this.gamedata.buttons[x].area.y2-=L}else{L=(this.gamedata.buttons[y].area.y2-this.gamedata.buttons[x].area.y1)/2;this.gamedata.buttons[y].area.y2-=L,this.gamedata.buttons[x].area.y1+=L}}},onConfigError:function(t){console.log("** ERROR ** lcdgame.js - onConfigError: error loading json file"),console.error(t)},loadMetadata:function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status||0===e.status?this.onMetadataLoad(JSON.parse(e.responseText)):this.onMetadataError(e))}.bind(this),e.open("GET",t,!0),e.send()},tinyMarkDown:function(t){return t=(t=(t=(t=t.replace(/\n/gi,"<br/>")).replace(/\*.*?\*/g,function(t){return"<b>"+t.slice(1,-1)+"</b>"})).replace(/\_.*?\_/g,function(t){return"<i>"+t.slice(1,-1)+"</i>"})).replace(/\[.*?\]/g,function(t){return"<btn>"+t.slice(1,-1)+"</btn>"})},onMetadataLoad:function(t){this.metadata=t;var e=this.tinyMarkDown(t.gameinfo.instructions.en);this.infocontent.innerHTML="<h1>"+t.gameinfo.device.title+"</h1><br/>"+e;var a=t.gameinfo.device.title,s=t.gameinfo.gametypes;this.gametype=void 0===s?0:1,this.highscores=new LCDGame.HighScores(this,a,s),this.highscores.loadHighscores(this.gametype),this.highscores.refreshGlobalHS()},onMetadataError:function(t){console.log("** ERROR ** lcdgame.js - onMetadataError: error loading json file"),console.error(t)},resizeCanvas:function(){var t=window.innerWidth/window.innerHeight,e=this.canvas.width/this.canvas.height,a=this.canvas.width,s=this.canvas.height;if(t<e){a=window.innerWidth,this.scaleFactor=a/this.canvas.width,s=this.canvas.height*this.scaleFactor;var i=(window.innerHeight-s)/2;this.canvas.style["margin-top"]=i+"px",this.canvas.style["margin-bottom"]=-i+"px",this.canvas.style["margin-left"]="0px"}else{s=window.innerHeight,this.scaleFactor=s/this.canvas.height,a=this.canvas.width*this.scaleFactor;var n=(window.innerWidth-a)/2;this.canvas.style["margin-left"]=n+"px",this.canvas.style["margin-right"]=-n+"px",this.canvas.style["margin-top"]="0px"}this.canvas.style.width=a+"px",this.canvas.style.height=s+"px",this.canvas.style.display="block",this.canvas.style["touch-action"]="none",this.canvas.style["user-select"]="none",this.canvas.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)"},resizeInfobox:function(t){var e=t.offsetWidth,a=t.offsetHeight,s=t.getBoundingClientRect();s&&(e=s.width,a=s.height);var i=(window.innerWidth-e)/2,n=(window.innerHeight-a)/2;t.style["margin-left"]=i+"px",t.style["margin-right"]=-i+"px",t.style["margin-top"]=n+"px",t.style["margin-bottom"]=-n+"px"},initGame:function(){document.body.scrollTop=0,document.body.style.overflow="hidden",this.canvas.width=this.imageBackground.width,this.canvas.height=this.imageBackground.height,this.context2d.drawImage(this.imageBackground,0,0);for(var t=0;t<this.gamedata.sounds.length;t++){var e=this.gamedata.sounds[t].filename;this.gamedata.sounds[t].audio=new Audio(e),this.gamedata.sounds[t].audio.load()}document.addEventListener?(this.canvas.addEventListener("mousedown",this.ontouchdown.bind(this),!1),this.canvas.addEventListener("mouseup",this.ontouchup.bind(this),!1),document.addEventListener("keydown",this.onkeydown.bind(this),!1),document.addEventListener("keyup",this.onkeyup.bind(this),!1)):(this.canvas.attachEvent("mousedown",this.ontouchdown.bind(this)),this.canvas.attachEvent("mouseup",this.ontouchup.bind(this)),document.attachEvent("keydown",this.onkeydown.bind(this)),document.attachEvent("keyup",this.onkeyup.bind(this))),this.resizeCanvas(),this.resizeInfobox(this.infobox),this.resizeInfobox(this.scorebox),hideInfobox(),hideScorebox(),console.log("lcdgame.js - ready to rock!")},gameReset:function(t){this.score=0,this.level=0,this.gametype=t},loadSoundEffects:function(){console.log("loadSoundEffects - TODO load sound effects")},soundIndexByName:function(t){for(var e=0;e<this.gamedata.sounds.length;e++)if(this.gamedata.sounds[e].name==t)return e;return-1},playSoundEffect:function(t){var e=this.soundIndexByName(t);0<=e&&(0==this.gamedata.sounds[e].audio.paused&&(this.gamedata.sounds[e].audio.pause(),this.gamedata.sounds[e].audio.currentTime=0),this.gamedata.sounds[e].audio.play())},shapeIndexByName:function(t){for(var e=0;e<this.gamedata.frames.length;e++)if(this.gamedata.frames[e].filename==t)return e;throw console.log("** ERROR ** shapeIndexByName('"+t+"') - filename not found."),"lcdgames.js - "+arguments.callee.caller.toString()+", no frame with filename '"+t+"'"},setShapeByName:function(t,e){for(var a=0;a<this.gamedata.frames.length;a++)if(this.gamedata.frames[a].filename==t)return this.gamedata.frames[a].value=e,!0;return!1},setShapeByIdx:function(t,e){return this.gamedata.frames[t].value=e,!0},sequenceIndexByName:function(t){if(this.gamedata.sequences){for(var e=0;e<this.gamedata.sequences.length;e++)if(this.gamedata.sequences[e].name==t)return e;throw console.log("** ERROR ** sequenceIndexByName('"+t+"') - sequence name not found."),"lcdgames.js - "+arguments.callee.caller.toString()+", no sequence with name '"+t+"'"}return-1},sequenceClear:function(t){for(var e=this.sequenceIndexByName(t),a=0;a<this.gamedata.sequences[e].ids.length;a++){var s=this.gamedata.sequences[e].ids[a];this.gamedata.frames[s].value=!1}},sequenceShift:function(t,e){var a,s=this.sequenceIndexByName(t);for(void 0===e&&(e=this.gamedata.sequences[s].ids.length),a=e-1;0<a;a--){var i=this.gamedata.sequences[s].ids[a-1],n=this.gamedata.sequences[s].ids[a];this.gamedata.frames[n].value=this.gamedata.frames[i].value}i=this.gamedata.sequences[s].ids[0];this.gamedata.frames[i].value=!1},sequenceShiftReverse:function(t,e){var a,s=this.sequenceIndexByName(t);for(void 0===e&&(e=0),a=e;a<this.gamedata.sequences[s].ids.length-1;a++){var i=this.gamedata.sequences[s].ids[a],n=this.gamedata.sequences[s].ids[a+1];this.gamedata.frames[i].value=this.gamedata.frames[n].value}i=this.gamedata.sequences[s].ids[a];this.gamedata.frames[i].value=!1},sequenceSetFirst:function(t,e){var a=this.sequenceIndexByName(t),s=this.gamedata.sequences[a].ids[0];this.gamedata.frames[s].value=e},sequenceSetPos:function(t,e,a){if(this.gamedata.sequences){var s=this.sequenceIndexByName(t);-1==e&&(e=this.gamedata.sequences[s].ids.length-1);var i=this.gamedata.sequences[s].ids[e];this.gamedata.frames[i].value=a}},sequenceShapeVisible:function(t,e){var a=this.sequenceIndexByName(t);if(void 0===e)for(var s=0;s<this.gamedata.sequences[a].ids.length;s++){var i=this.gamedata.sequences[a].ids[s];if(1==this.gamedata.frames[i].value)return!0}else{-1==e&&(e=this.gamedata.sequences[a].ids.length-1);i=this.gamedata.sequences[a].ids[e];if(1==this.gamedata.frames[i].value)return!0}return!1},shapesDisplayAll:function(t){if(this.gamedata.frames){for(var e=0;e<this.gamedata.frames.length;e++)"shape"!=this.gamedata.frames[e].type&&"digitpos"!=this.gamedata.frames[e].type||(this.gamedata.frames[e].value=t);if(1==t)for(e=0;e<this.gamedata.digits.length;e++)this.digitsDisplay(this.gamedata.digits[e].name,this.gamedata.digits[e].max)}},digitsDisplay:function(t,e,a){for(var s=-1,i=0;i<this.gamedata.digits.length;i++)if(this.gamedata.digits[i].name==t){s=i;break}if(-1!=s){var n=0,o=0;1==a&&(o=this.gamedata.digits[s].locids.length-e.length)<0&&(n=Math.abs(o),o=0);for(i=0;i<this.gamedata.digits[s].locids.length;i++){var r=this.gamedata.digits[s].locids[i];if(i<o||n>=e.length)this.gamedata.frames[r].value=!1;else{var d=e.charCodeAt(n)-48;if(0<=d&&d<this.gamedata.digits[s].ids.length){var h=this.gamedata.digits[s].ids[d];this.gamedata.frames[r].frame.x=this.gamedata.frames[h].frame.x,this.gamedata.frames[r].frame.y=this.gamedata.frames[h].frame.y,this.gamedata.frames[r].value=!0}else this.gamedata.frames[r].value=!1;n+=1}}}},shapesRefresh:function(){if(this.gamedata.frames){this.context2d.drawImage(this.imageBackground,0,0);for(var t=0;t<this.gamedata.frames.length;t++)1==this.gamedata.frames[t].value&&this.shapeDraw(t)}},shapeDraw:function(t){this.context2d.drawImage(this.imageShapes,this.gamedata.frames[t].frame.x,this.gamedata.frames[t].frame.y,this.gamedata.frames[t].frame.w,this.gamedata.frames[t].frame.h,this.gamedata.frames[t].spriteSourceSize.x,this.gamedata.frames[t].spriteSourceSize.y,this.gamedata.frames[t].spriteSourceSize.w,this.gamedata.frames[t].spriteSourceSize.h)},debugText:function(t,e,a){this.context2d.font="bold 12px sans-serif";for(var s=t.split("\n"),i=0;i<s.length;i++)this.context2d.fillStyle="#000",this.context2d.fillText(s[i],e+2,a+2),this.context2d.fillStyle="#fff",this.context2d.fillText(s[i],e,a),a+=15},buttonAdd:function(t,e,a){void 0===this.buttons&&(this.buttons=[]);var s=this.gamedata.buttons.length;this.gamedata.buttons[s]={},this.gamedata.buttons[s].name=t,this.gamedata.buttons[s].frames=e,this.gamedata.buttons[s].defaultkeys=a,this.gamedata.buttons[s].keycodes=this.determineKeyCodes(a)},determineKeyCodes:function(t){for(var e=[],a=0;a<t.length;a++){var s=0,i=t[a];s=-1<(i=i.toUpperCase()).indexOf("UP")?38:-1<i.indexOf("DOWN")?40:-1<i.indexOf("LEFT")?37:-1<i.indexOf("RIGHT")?39:i.charCodeAt(0),e.push(s)}return e},ontouchdown:function(t){for(var e=t.offsetX/this.scaleFactor,a=t.offsetY/this.scaleFactor,s=0;s<this.gamedata.buttons.length;s++)if(e>this.gamedata.buttons[s].area.x1&&e<this.gamedata.buttons[s].area.x2&&a>this.gamedata.buttons[s].area.y1&&a<this.gamedata.buttons[s].area.y2){var i=0;switch(this.gamedata.buttons[s].type){case"updown":var n=(this.gamedata.buttons[s].area.y2-this.gamedata.buttons[s].area.y1)/2;i=a<this.gamedata.buttons[s].area.y1+n?0:1;break;case"leftright":n=(this.gamedata.buttons[s].area.x2-this.gamedata.buttons[s].area.x1)/2;i=e<this.gamedata.buttons[s].area.x1+n?0:1}this.onButtonDown(s,i)}},ontouchup:function(t){for(var e=t.offsetX/this.scaleFactor,a=t.offsetY/this.scaleFactor,s=0;s<this.gamedata.buttons.length;s++)if(e>this.gamedata.buttons[s].area.x1&&e<this.gamedata.buttons[s].area.x2&&a>this.gamedata.buttons[s].area.y1&&a<this.gamedata.buttons[s].area.y2){var i=0;switch(this.gamedata.buttons[s].type){case"updown":var n=(this.gamedata.buttons[s].area.y2-this.gamedata.buttons[s].area.y1)/2;i=a<this.gamedata.buttons[s].area.y1+n?0:1;break;case"leftright":n=(this.gamedata.buttons[s].area.x2-this.gamedata.buttons[s].area.x1)/2;i=e<this.gamedata.buttons[s].area.x1+n?0:1}this.onButtonUp(s,i)}},onkeydown:function(t){for(var e=t.keyCode,a=0;a<this.gamedata.buttons.length;a++)for(var s=0;s<this.gamedata.buttons[a].keycodes.length;s++)this.gamedata.buttons[a].keycodes[s]==e&&this.onButtonDown(a,s)},onkeyup:function(t){for(var e=t.keyCode,a=0;a<this.gamedata.buttons.length;a++)for(var s=0;s<this.gamedata.buttons[a].keycodes.length;s++)this.gamedata.buttons[a].keycodes[s]==e&&this.onButtonUp(a)},onButtonDown:function(t,e){var a=this.gamedata.buttons[t].name;this.state.currentState().input(a,e);var s=this.gamedata.buttons[t].ids[e];this.setShapeByIdx(s,!0),this.shapesRefresh()},onButtonUp:function(t,e){for(var a=0;a<this.gamedata.buttons[t].ids.length;a++){var s=this.gamedata.buttons[t].ids[a];this.setShapeByIdx(s,!1)}this.shapesRefresh()},debugRectangle:function(t,e,a,s){this.context2d.beginPath(),this.context2d.lineWidth="1",this.context2d.strokeStyle="#f0f",this.context2d.fillStyle="#f0f",this.context2d.rect(t,e,a,s),this.context2d.stroke()},is_touch_device:function(){var t=document.createElement("div");return t.setAttribute("lcdgame.js - ongesturestart","return;"),"function"==typeof t.ongesturestart}},LCDGame.BPMToMillSec=function(t){return 6e4/t},LCDGame.Shape=function(t,e){this.lcdgame=t,this.framename=e,this.idx=0},LCDGame.Button=function(t,e){this.lcdgame=t,this.name=e,this.keycodes=[]},LCDGame.Timer=function(t,e,a){this.game=t,this.Interval=a||1e3,this.Counter=0,this.Max=null,this.Enable=new Boolean(!1),this.doGameEvent=e;this.doTimerEvent=function(){this.Counter++,this.doGameEvent.call(this.game),void 0!==this.Max&&this.Counter>=this.Max&&this.Stop()},this.Start=function(t){this.Enable=new Boolean(!0),this.Counter=0,this.Max=t;var e=this.doTimerEvent.bind(this);this.Enable&&(this.timerId&&clearInterval(this.timerId),this.timerId=setInterval(e,this.Interval))},this.Stop=function(){this.Enable=new Boolean(!1),clearInterval(this.timerId)}};